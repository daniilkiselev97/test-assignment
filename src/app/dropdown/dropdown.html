<div class="dropdown">
  <div
    class="dropdown-header"
    role="combobox"
    tabindex="0"
    aria-haspopup="listbox"
    [attr.aria-expanded]="isOpen"
    [attr.aria-controls]="'dropdown-panel'"
    [attr.aria-activedescendant]="activeItemId"
    (click)="toggle()"
  >
    <span>{{ getHeaderLabel() }}</span>
    <span class="arrow">▼</span>
  </div>

  <div
    class="dropdown-panel"
    *ngIf="isOpen"
    role="listbox"
    id="dropdown-panel"
    [attr.aria-multiselectable]="mode === 'multi'"
  >
    <input
      *ngIf="enableSearch"
      type="text"
      [formControl]="searchControl"
      placeholder="Поиск..."
      aria-label="Поиск"
    />

    <ng-container *ngIf="!groups.length">
      <div
        *ngFor="let item of filteredItems; let i = index"
        class="dropdown-item"
        role="option"
        [id]="'option-' + item.value"
        [attr.aria-selected]="isSelected(item.value)"
        (click)="select(item)"
        [class.selected]="isSelected(item.value)"
        [class.active]="i === activeIndex"
      >
        {{ item.label }}
      </div>
    </ng-container>

    <ng-container *ngIf="groups.length">
      <div *ngFor="let group of filteredGroups">
        <div
          class="dropdown-group-label"
          role="group"
          [attr.aria-label]="group.label"
          [class.disabled]="group.disabled"
        >
          {{ group.label }}
        </div>
        <div
          *ngFor="let item of group.items"
          class="dropdown-item"
          role="option"
          [id]="'option-' + item.value"
          [attr.aria-selected]="isSelected(item.value)"
          (click)="select(item, group.disabled)"
          [class.selected]="isSelected(item.value)"
          [class.disabled]="group.disabled"
          [class.active]="activeItemId === 'option-' + item.value"
        >
          {{ item.label }}
        </div>
      </div>
    </ng-container>
  </div>
</div>
